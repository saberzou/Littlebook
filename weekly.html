<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This Week â€” Littlebook</title>
    <meta name="description" content="Browse the past seven days of curated book recommendations.">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body class="weekly-body">
    <div class="weekly-container" style="position:relative;">

        <!-- Theme toggle -->
        <button class="theme-toggle weekly-theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
            <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </button>

        <header class="weekly-header">
            <h1>This Week</h1>
            <p>Seven days of great reads</p>
        </header>

        <main class="weekly-list" id="weeklyList">
            <!-- Rendered by JS -->
        </main>

        <!-- iOS 26 pill nav -->
        <nav class="pill-nav">
            <a href="index.html" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                </svg>
                <span class="nav-label">Today</span>
            </a>
            <a href="weekly.html" class="nav-item active">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span class="nav-label">Week</span>
            </a>
        </nav>
    </div>

    <script src="data.js"></script>
    <script>
        'use strict';

        function renderWeeklyList() {
            const container = document.getElementById('weeklyList');
            const today = new Date().toISOString().split('T')[0];

            for (let i = 0; i < DailyData.data.length; i++) {
                const data = DailyData.data[i];
                const isToday = data.date === today;
                const placeholderSvg = 'data:image/svg+xml,' + encodeURIComponent(
                    '<svg xmlns="http://www.w3.org/2000/svg" width="72" height="100" fill="%23F5F0EB">' +
                    '<rect width="72" height="100"/>' +
                    '<text x="36" y="54" text-anchor="middle" fill="%236B5E55" font-family="serif" font-size="10">Book</text>' +
                    '</svg>'
                );

                const card = document.createElement('a');
                card.href = `index.html?date=${encodeURIComponent(data.date)}`;
                card.className = `day-card${isToday ? ' today' : ''}`;

                const num = document.createElement('div');
                num.className = 'day-number';
                num.textContent = String(i + 1).padStart(2, '0');

                const cover = document.createElement('div');
                cover.className = 'day-cover';
                const img = document.createElement('img');
                img.src = placeholderSvg;
                img.alt = data.book.title;
                img.loading = 'lazy';
                DailyData.fetchBestCover(data.book.isbn, data.book.title, data.book.author).then(url => {
                    if (url) img.src = url;
                });
                cover.appendChild(img);

                const info = document.createElement('div');
                info.className = 'day-info';

                const h3 = document.createElement('h3');
                h3.textContent = data.book.title;

                const author = document.createElement('p');
                author.className = 'author';
                author.textContent = data.book.author;

                const meta = document.createElement('div');
                meta.className = 'meta';
                const catSpan = document.createElement('span');
                catSpan.textContent = data.book.category;
                meta.appendChild(catSpan);

                if (isToday) {
                    const badge = document.createElement('span');
                    badge.className = 'today-badge';
                    badge.textContent = 'Today';
                    meta.appendChild(badge);
                }

                info.appendChild(h3);
                info.appendChild(author);
                info.appendChild(meta);

                card.appendChild(num);
                card.appendChild(cover);
                card.appendChild(info);
                container.appendChild(card);
            }
        }

        // Dark mode
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                localStorage.setItem('littlebook-theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                localStorage.setItem('littlebook-theme', 'dark');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Restore theme
            const saved = localStorage.getItem('littlebook-theme');
            if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }

            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            renderWeeklyList();
        });
    </script>
</body>
</html>
